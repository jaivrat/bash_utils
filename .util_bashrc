# Common utilities for bash

# To tar and gzip a folder
targz() {
  if [ -z "$1" ]; then
    echo "Usage: targz folder_path"
    return 1
  fi
  folder="$1"
  base=$(basename "$folder")
  dir=$(dirname "$folder")
  tar -czf "${base}.tar.gz" -C "$dir" "$base"
}


tmux_commands() {

 echo ''
 echo '=====CREATION     ======='
 echo 'tmux ls                  # Show all sessions'
 echo 'tmux attach -t mysession   # Attach to my session'
 echo 'tmux new -s mysession    #For new session'
 echo 'tmux kill-ses -t mysession # KILL session'
 echo 'tmux rename-session -t old_name new_name    # RENAME session'


 echo ''


 echo ''
 echo '=====SPLIT WINDOWS======='
 echo ':split-window -v'
 echo ':ctrl+b %'
 echo ':split-window -h'
 echo ':ctrl+b "'
 echo ':ctrl+b SPACEBAR     # Toggle between pane layouts'

}

tmux2w() {
    # To create a tmux session with two windows
    # One for main process and other for its log
    local SESSION="$1"

    if [ -z "$SESSION" ]; then
        echo "Usage: tmux2w <session-name>"
        return 1
    fi

    # Check if session exists
    if tmux has-session -t "$SESSION" 2>/dev/null; then
        echo "Error: Session '$SESSION' already exists."
        return 1
    fi

    # Create the session with first pane running strat
    tmux new-session -d -s "$SESSION" -n main
    tmux send-keys -t "$SESSION:0.0" "strat" C-m

    # Split horizontally (-h) for side-by-side; use -v for top/bottom
    tmux split-window -h -t "$SESSION:0"
    tmux send-keys -t "$SESSION:0.1" "cd ~/temp/logs" C-m

    # Attach to the new session
    tmux attach -t "$SESSION"
}


# How can i confgure my tmux, so that the Mac machine's terminal tab i am using 
# changes the to the session name of tmux. Note that I am using terminal on my 
# home machine, to connect to remote linux machine where i start tmux sessions
# This is doable with some shell prompt magic and tmux config. Hereâ€™s the general approach:
# Function to set terminal tab/window title
function set_tmux_tab_title() {
    # Only if inside tmux
    if [ -n "$TMUX" ]; then
        # Extract session name from TMUX environment variable or from tmux itself
        # TMUX session name can be extracted with:
        local session_name
        session_name=$(tmux display-message -p '#S')

        # Escape sequence to set title: \033]0;title\007
        # This will tell your Mac terminal to set the tab/window title
        echo -ne "\033]0;tmux:$session_name\007"
    else
        # Optional: set some default title when not in tmux
        echo -ne "\033]0;bash\007"
    fi
}

# Call this function every time prompt is shown
# PROMPT_COMMAND=set_tmux_tab_title

update_terminal_tab_title() {
  if [ -n "$TMUX" ]; then
    local session_name
    session_name=$(tmux display-message -p '#S' 2>/dev/null)
    if [ -n "$session_name" ]; then
      echo -ne "\033]0;tmux:$session_name\007"
    fi
  else
    # Optional: set a default title when not in tmux
    echo -ne "\033]0;remote-shell\007"
  fi
}

PROMPT_COMMAND="update_terminal_tab_title${PROMPT_COMMAND:+;$PROMPT_COMMAND}"

